============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-7.4.3, pluggy-1.6.0 -- /mnt/d/ENGINEER/VS_Code/eduautismo-ia-mvp/venv/bin/python
cachedir: .pytest_cache
rootdir: /mnt/d/ENGINEER/VS_Code/eduautismo-ia-mvp/backend
plugins: anyio-3.7.1
collecting ... collected 15 items

tests/integration/test_activities_api.py::TestActivitiesAPI::test_generate_activity_success PASSED [  6%]
tests/integration/test_activities_api.py::TestActivitiesAPI::test_generate_activity_without_auth ERROR [ 13%]
tests/integration/test_activities_api.py::TestActivitiesAPI::test_generate_activity_nonexistent_student ERROR [ 20%]
tests/integration/test_activities_api.py::TestActivitiesAPI::test_generate_activity_invalid_duration ERROR [ 26%]
tests/integration/test_activities_api.py::TestActivitiesAPI::test_generate_multiple_activity_types ERROR [ 33%]
tests/integration/test_auth_api.py::TestAuthAPI::test_register_user_success PASSED [ 40%]
tests/integration/test_auth_api.py::TestAuthAPI::test_register_duplicate_email ERROR [ 46%]
tests/integration/test_auth_api.py::TestAuthAPI::test_login_success ERROR [ 53%]
tests/integration/test_auth_api.py::TestAuthAPI::test_login_invalid_credentials ERROR [ 60%]
tests/integration/test_auth_api.py::TestAuthAPI::test_get_current_user ERROR [ 66%]
tests/integration/test_auth_api.py::TestAuthAPI::test_unauthorized_access FAILED [ 73%]
tests/integration/test_students_api.py::TestStudentsAPI::test_create_student_success ERROR [ 80%]
tests/integration/test_students_api.py::TestStudentsAPI::test_create_student_without_auth PASSED [ 86%]
tests/integration/test_students_api.py::TestStudentsAPI::test_create_student_invalid_date ERROR [ 93%]
tests/integration/test_students_api.py::TestStudentsAPI::test_create_student_too_young ERROR [100%]

==================================== ERRORS ====================================
___ ERROR at setup of TestActivitiesAPI.test_generate_activity_without_auth ____
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.UniqueViolation: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(test@example.com) already exists.

The above exception was the direct cause of the following exception:
tests/conftest.py:92: in test_user
    db_session.commit()
../venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:1969: in commit
    trans.commit(_to_root=True)
../venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py:139: in _go
    ret_value = fn(self, *arg, **kw)
../venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:1256: in commit
    self._prepare_impl()
../venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py:139: in _go
    ret_value = fn(self, *arg, **kw)
../venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:1231: in _prepare_impl
    self.session.flush()
../venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4312: in flush
    self._flush(objects)
../venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4447: in _flush
    with util.safe_reraise():
../venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:146: in __exit__
    raise exc_value.with_traceback(exc_tb)
../venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4408: in _flush
    flush_context.execute()
../venv/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
../venv/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
../venv/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
../venv/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py:1226: in _emit_insert_statements
    result = connection.execute(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1416: in execute
    return meth(
../venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:516: in _execute_on_connection
    return connection._execute_clauseelement(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1639: in _execute_clauseelement
    ret = self._execute_context(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1848: in _execute_context
    return self._exec_single_context(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1988: in _exec_single_context
    self._handle_dbapi_exception(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2343: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.IntegrityError: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(test@example.com) already exists.
E   
E   [SQL: INSERT INTO users (email, hashed_password, full_name, role, is_active, is_verified, phone, avatar_url, bio, institution, last_login, reset_token, reset_token_expires, verification_token, id, created_at, updated_at) VALUES (%(email)s, %(hashed_password)s, %(full_name)s, %(role)s, %(is_active)s, %(is_verified)s, %(phone)s, %(avatar_url)s, %(bio)s, %(institution)s, %(last_login)s, %(reset_token)s, %(reset_token_expires)s, %(verification_token)s, %(id)s::UUID, %(created_at)s, %(updated_at)s)]
E   [parameters: {'email': 'test@example.com', 'hashed_password': '$2b$12$gCZ89UbdjY.HrICwAUP7eOICsZzB6v5j2kDsQg8WddkfWN4NqwsHe', 'full_name': 'Test User', 'role': 'TEACHER', 'is_active': True, 'is_verified': True, 'phone': None, 'avatar_url': None, 'bio': None, 'institution': None, 'last_login': None, 'reset_token': None, 'reset_token_expires': None, 'verification_token': None, 'id': UUID('c97d00ed-13de-4729-bb33-c0ff2cc8505f'), 'created_at': datetime.datetime(2025, 11, 11, 14, 4, 10, 596755), 'updated_at': datetime.datetime(2025, 11, 11, 14, 4, 10, 596760)}]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
üöÄ Starting EduAutismo IA API
üìç Environment: development
üîß Debug Mode: True
‚ö†Ô∏è  Database initialization warning: (psycopg2.OperationalError) could not translate host name "postgres" to address: Temporary failure in name resolution

(Background on this error at: https://sqlalche.me/e/20/e3q8)
_ ERROR at setup of TestActivitiesAPI.test_generate_activity_nonexistent_student _
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.UniqueViolation: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(test@example.com) already exists.

The above exception was the direct cause of the following exception:
tests/conftest.py:92: in test_user
    db_session.commit()
../venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:1969: in commit
    trans.commit(_to_root=True)
../venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py:139: in _go
    ret_value = fn(self, *arg, **kw)
../venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:1256: in commit
    self._prepare_impl()
../venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py:139: in _go
    ret_value = fn(self, *arg, **kw)
../venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:1231: in _prepare_impl
    self.session.flush()
../venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4312: in flush
    self._flush(objects)
../venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4447: in _flush
    with util.safe_reraise():
../venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:146: in __exit__
    raise exc_value.with_traceback(exc_tb)
../venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4408: in _flush
    flush_context.execute()
../venv/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
../venv/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
../venv/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
../venv/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py:1226: in _emit_insert_statements
    result = connection.execute(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1416: in execute
    return meth(
../venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:516: in _execute_on_connection
    return connection._execute_clauseelement(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1639: in _execute_clauseelement
    ret = self._execute_context(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1848: in _execute_context
    return self._exec_single_context(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1988: in _exec_single_context
    self._handle_dbapi_exception(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2343: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.IntegrityError: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(test@example.com) already exists.
E   
E   [SQL: INSERT INTO users (email, hashed_password, full_name, role, is_active, is_verified, phone, avatar_url, bio, institution, last_login, reset_token, reset_token_expires, verification_token, id, created_at, updated_at) VALUES (%(email)s, %(hashed_password)s, %(full_name)s, %(role)s, %(is_active)s, %(is_verified)s, %(phone)s, %(avatar_url)s, %(bio)s, %(institution)s, %(last_login)s, %(reset_token)s, %(reset_token_expires)s, %(verification_token)s, %(id)s::UUID, %(created_at)s, %(updated_at)s)]
E   [parameters: {'email': 'test@example.com', 'hashed_password': '$2b$12$fAh.8OSB.fvGGh1a2HYhuOR7VEputpBjahSAwdEcLItBXV1IqPrAW', 'full_name': 'Test User', 'role': 'TEACHER', 'is_active': True, 'is_verified': True, 'phone': None, 'avatar_url': None, 'bio': None, 'institution': None, 'last_login': None, 'reset_token': None, 'reset_token_expires': None, 'verification_token': None, 'id': UUID('2bd6627e-4950-4c13-9a0c-123292e2494c'), 'created_at': datetime.datetime(2025, 11, 11, 14, 4, 24, 350716), 'updated_at': datetime.datetime(2025, 11, 11, 14, 4, 24, 350722)}]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
üöÄ Starting EduAutismo IA API
üìç Environment: development
üîß Debug Mode: True
‚ö†Ô∏è  Database initialization warning: (psycopg2.OperationalError) could not translate host name "postgres" to address: Temporary failure in name resolution

(Background on this error at: https://sqlalche.me/e/20/e3q8)
_ ERROR at setup of TestActivitiesAPI.test_generate_activity_invalid_duration __
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.UniqueViolation: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(test@example.com) already exists.

The above exception was the direct cause of the following exception:
tests/conftest.py:92: in test_user
    db_session.commit()
../venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:1969: in commit
    trans.commit(_to_root=True)
../venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py:139: in _go
    ret_value = fn(self, *arg, **kw)
../venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:1256: in commit
    self._prepare_impl()
../venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py:139: in _go
    ret_value = fn(self, *arg, **kw)
../venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:1231: in _prepare_impl
    self.session.flush()
../venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4312: in flush
    self._flush(objects)
../venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4447: in _flush
    with util.safe_reraise():
../venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:146: in __exit__
    raise exc_value.with_traceback(exc_tb)
../venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4408: in _flush
    flush_context.execute()
../venv/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
../venv/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
../venv/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
../venv/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py:1226: in _emit_insert_statements
    result = connection.execute(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1416: in execute
    return meth(
../venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:516: in _execute_on_connection
    return connection._execute_clauseelement(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1639: in _execute_clauseelement
    ret = self._execute_context(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1848: in _execute_context
    return self._exec_single_context(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1988: in _exec_single_context
    self._handle_dbapi_exception(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2343: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.IntegrityError: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(test@example.com) already exists.
E   
E   [SQL: INSERT INTO users (email, hashed_password, full_name, role, is_active, is_verified, phone, avatar_url, bio, institution, last_login, reset_token, reset_token_expires, verification_token, id, created_at, updated_at) VALUES (%(email)s, %(hashed_password)s, %(full_name)s, %(role)s, %(is_active)s, %(is_verified)s, %(phone)s, %(avatar_url)s, %(bio)s, %(institution)s, %(last_login)s, %(reset_token)s, %(reset_token_expires)s, %(verification_token)s, %(id)s::UUID, %(created_at)s, %(updated_at)s)]
E   [parameters: {'email': 'test@example.com', 'hashed_password': '$2b$12$DGtKH9AeL/AxlhjTmM6W.OC88uIItMTjBE2RVTb.qghuzUmbAsWVG', 'full_name': 'Test User', 'role': 'TEACHER', 'is_active': True, 'is_verified': True, 'phone': None, 'avatar_url': None, 'bio': None, 'institution': None, 'last_login': None, 'reset_token': None, 'reset_token_expires': None, 'verification_token': None, 'id': UUID('c732151b-2969-43f8-a851-07ba90a87e68'), 'created_at': datetime.datetime(2025, 11, 11, 14, 4, 35, 288169), 'updated_at': datetime.datetime(2025, 11, 11, 14, 4, 35, 288176)}]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
üöÄ Starting EduAutismo IA API
üìç Environment: development
üîß Debug Mode: True
‚ö†Ô∏è  Database initialization warning: (psycopg2.OperationalError) could not translate host name "postgres" to address: Temporary failure in name resolution

(Background on this error at: https://sqlalche.me/e/20/e3q8)
__ ERROR at setup of TestActivitiesAPI.test_generate_multiple_activity_types ___
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.UniqueViolation: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(test@example.com) already exists.

The above exception was the direct cause of the following exception:
tests/conftest.py:92: in test_user
    db_session.commit()
../venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:1969: in commit
    trans.commit(_to_root=True)
../venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py:139: in _go
    ret_value = fn(self, *arg, **kw)
../venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:1256: in commit
    self._prepare_impl()
../venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py:139: in _go
    ret_value = fn(self, *arg, **kw)
../venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:1231: in _prepare_impl
    self.session.flush()
../venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4312: in flush
    self._flush(objects)
../venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4447: in _flush
    with util.safe_reraise():
../venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:146: in __exit__
    raise exc_value.with_traceback(exc_tb)
../venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4408: in _flush
    flush_context.execute()
../venv/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
../venv/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
../venv/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
../venv/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py:1226: in _emit_insert_statements
    result = connection.execute(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1416: in execute
    return meth(
../venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:516: in _execute_on_connection
    return connection._execute_clauseelement(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1639: in _execute_clauseelement
    ret = self._execute_context(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1848: in _execute_context
    return self._exec_single_context(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1988: in _exec_single_context
    self._handle_dbapi_exception(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2343: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.IntegrityError: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(test@example.com) already exists.
E   
E   [SQL: INSERT INTO users (email, hashed_password, full_name, role, is_active, is_verified, phone, avatar_url, bio, institution, last_login, reset_token, reset_token_expires, verification_token, id, created_at, updated_at) VALUES (%(email)s, %(hashed_password)s, %(full_name)s, %(role)s, %(is_active)s, %(is_verified)s, %(phone)s, %(avatar_url)s, %(bio)s, %(institution)s, %(last_login)s, %(reset_token)s, %(reset_token_expires)s, %(verification_token)s, %(id)s::UUID, %(created_at)s, %(updated_at)s)]
E   [parameters: {'email': 'test@example.com', 'hashed_password': '$2b$12$Q7nOA5hn8t/AUwTyPhUac.jT0ZURt4p4EkNvGmxItZ9Nk9yxDCJ/y', 'full_name': 'Test User', 'role': 'TEACHER', 'is_active': True, 'is_verified': True, 'phone': None, 'avatar_url': None, 'bio': None, 'institution': None, 'last_login': None, 'reset_token': None, 'reset_token_expires': None, 'verification_token': None, 'id': UUID('b6bbd316-ad3b-49bb-ace1-e1b0a720b49f'), 'created_at': datetime.datetime(2025, 11, 11, 14, 4, 46, 204349), 'updated_at': datetime.datetime(2025, 11, 11, 14, 4, 46, 204355)}]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
üöÄ Starting EduAutismo IA API
üìç Environment: development
üîß Debug Mode: True
‚ö†Ô∏è  Database initialization warning: (psycopg2.OperationalError) could not translate host name "postgres" to address: Temporary failure in name resolution

(Background on this error at: https://sqlalche.me/e/20/e3q8)
_________ ERROR at setup of TestAuthAPI.test_register_duplicate_email __________
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.UniqueViolation: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(test@example.com) already exists.

The above exception was the direct cause of the following exception:
tests/conftest.py:92: in test_user
    db_session.commit()
../venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:1969: in commit
    trans.commit(_to_root=True)
../venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py:139: in _go
    ret_value = fn(self, *arg, **kw)
../venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:1256: in commit
    self._prepare_impl()
../venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py:139: in _go
    ret_value = fn(self, *arg, **kw)
../venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:1231: in _prepare_impl
    self.session.flush()
../venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4312: in flush
    self._flush(objects)
../venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4447: in _flush
    with util.safe_reraise():
../venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:146: in __exit__
    raise exc_value.with_traceback(exc_tb)
../venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4408: in _flush
    flush_context.execute()
../venv/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
../venv/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
../venv/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
../venv/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py:1226: in _emit_insert_statements
    result = connection.execute(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1416: in execute
    return meth(
../venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:516: in _execute_on_connection
    return connection._execute_clauseelement(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1639: in _execute_clauseelement
    ret = self._execute_context(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1848: in _execute_context
    return self._exec_single_context(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1988: in _exec_single_context
    self._handle_dbapi_exception(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2343: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.IntegrityError: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(test@example.com) already exists.
E   
E   [SQL: INSERT INTO users (email, hashed_password, full_name, role, is_active, is_verified, phone, avatar_url, bio, institution, last_login, reset_token, reset_token_expires, verification_token, id, created_at, updated_at) VALUES (%(email)s, %(hashed_password)s, %(full_name)s, %(role)s, %(is_active)s, %(is_verified)s, %(phone)s, %(avatar_url)s, %(bio)s, %(institution)s, %(last_login)s, %(reset_token)s, %(reset_token_expires)s, %(verification_token)s, %(id)s::UUID, %(created_at)s, %(updated_at)s)]
E   [parameters: {'email': 'test@example.com', 'hashed_password': '$2b$12$xm72cH7cQrdqkb.ao3A/TOBBPVSjWCPNU/05SeHm5wFIIOD0ID4Pu', 'full_name': 'Test User', 'role': 'TEACHER', 'is_active': True, 'is_verified': True, 'phone': None, 'avatar_url': None, 'bio': None, 'institution': None, 'last_login': None, 'reset_token': None, 'reset_token_expires': None, 'verification_token': None, 'id': UUID('0b32219b-1acb-4ce1-ab0a-f40bc28439cb'), 'created_at': datetime.datetime(2025, 11, 11, 14, 5, 5, 85086), 'updated_at': datetime.datetime(2025, 11, 11, 14, 5, 5, 85092)}]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
üöÄ Starting EduAutismo IA API
üìç Environment: development
üîß Debug Mode: True
‚ö†Ô∏è  Database initialization warning: (psycopg2.OperationalError) could not translate host name "postgres" to address: Temporary failure in name resolution

(Background on this error at: https://sqlalche.me/e/20/e3q8)
_______________ ERROR at setup of TestAuthAPI.test_login_success _______________
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.UniqueViolation: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(test@example.com) already exists.

The above exception was the direct cause of the following exception:
tests/conftest.py:92: in test_user
    db_session.commit()
../venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:1969: in commit
    trans.commit(_to_root=True)
../venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py:139: in _go
    ret_value = fn(self, *arg, **kw)
../venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:1256: in commit
    self._prepare_impl()
../venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py:139: in _go
    ret_value = fn(self, *arg, **kw)
../venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:1231: in _prepare_impl
    self.session.flush()
../venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4312: in flush
    self._flush(objects)
../venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4447: in _flush
    with util.safe_reraise():
../venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:146: in __exit__
    raise exc_value.with_traceback(exc_tb)
../venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4408: in _flush
    flush_context.execute()
../venv/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
../venv/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
../venv/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
../venv/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py:1226: in _emit_insert_statements
    result = connection.execute(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1416: in execute
    return meth(
../venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:516: in _execute_on_connection
    return connection._execute_clauseelement(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1639: in _execute_clauseelement
    ret = self._execute_context(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1848: in _execute_context
    return self._exec_single_context(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1988: in _exec_single_context
    self._handle_dbapi_exception(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2343: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.IntegrityError: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(test@example.com) already exists.
E   
E   [SQL: INSERT INTO users (email, hashed_password, full_name, role, is_active, is_verified, phone, avatar_url, bio, institution, last_login, reset_token, reset_token_expires, verification_token, id, created_at, updated_at) VALUES (%(email)s, %(hashed_password)s, %(full_name)s, %(role)s, %(is_active)s, %(is_verified)s, %(phone)s, %(avatar_url)s, %(bio)s, %(institution)s, %(last_login)s, %(reset_token)s, %(reset_token_expires)s, %(verification_token)s, %(id)s::UUID, %(created_at)s, %(updated_at)s)]
E   [parameters: {'email': 'test@example.com', 'hashed_password': '$2b$12$qV3IdjYaKfopgKHtk/EKq.kapFqozpp4laf5/jOuUpkDqniCZbXBW', 'full_name': 'Test User', 'role': 'TEACHER', 'is_active': True, 'is_verified': True, 'phone': None, 'avatar_url': None, 'bio': None, 'institution': None, 'last_login': None, 'reset_token': None, 'reset_token_expires': None, 'verification_token': None, 'id': UUID('f183e78d-25aa-4848-8fdd-a70d6b04b6d1'), 'created_at': datetime.datetime(2025, 11, 11, 14, 5, 15, 921518), 'updated_at': datetime.datetime(2025, 11, 11, 14, 5, 15, 921524)}]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
üöÄ Starting EduAutismo IA API
üìç Environment: development
üîß Debug Mode: True
‚ö†Ô∏è  Database initialization warning: (psycopg2.OperationalError) could not translate host name "postgres" to address: Temporary failure in name resolution

(Background on this error at: https://sqlalche.me/e/20/e3q8)
_________ ERROR at setup of TestAuthAPI.test_login_invalid_credentials _________
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.UniqueViolation: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(test@example.com) already exists.

The above exception was the direct cause of the following exception:
tests/conftest.py:92: in test_user
    db_session.commit()
../venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:1969: in commit
    trans.commit(_to_root=True)
../venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py:139: in _go
    ret_value = fn(self, *arg, **kw)
../venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:1256: in commit
    self._prepare_impl()
../venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py:139: in _go
    ret_value = fn(self, *arg, **kw)
../venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:1231: in _prepare_impl
    self.session.flush()
../venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4312: in flush
    self._flush(objects)
../venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4447: in _flush
    with util.safe_reraise():
../venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:146: in __exit__
    raise exc_value.with_traceback(exc_tb)
../venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4408: in _flush
    flush_context.execute()
../venv/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
../venv/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
../venv/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
../venv/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py:1226: in _emit_insert_statements
    result = connection.execute(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1416: in execute
    return meth(
../venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:516: in _execute_on_connection
    return connection._execute_clauseelement(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1639: in _execute_clauseelement
    ret = self._execute_context(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1848: in _execute_context
    return self._exec_single_context(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1988: in _exec_single_context
    self._handle_dbapi_exception(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2343: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.IntegrityError: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(test@example.com) already exists.
E   
E   [SQL: INSERT INTO users (email, hashed_password, full_name, role, is_active, is_verified, phone, avatar_url, bio, institution, last_login, reset_token, reset_token_expires, verification_token, id, created_at, updated_at) VALUES (%(email)s, %(hashed_password)s, %(full_name)s, %(role)s, %(is_active)s, %(is_verified)s, %(phone)s, %(avatar_url)s, %(bio)s, %(institution)s, %(last_login)s, %(reset_token)s, %(reset_token_expires)s, %(verification_token)s, %(id)s::UUID, %(created_at)s, %(updated_at)s)]
E   [parameters: {'email': 'test@example.com', 'hashed_password': '$2b$12$LNGQuAuZLLdkBKcLBJWXpOUDueUSUVK83X1HWEWh5iPlUUFs3m6vq', 'full_name': 'Test User', 'role': 'TEACHER', 'is_active': True, 'is_verified': True, 'phone': None, 'avatar_url': None, 'bio': None, 'institution': None, 'last_login': None, 'reset_token': None, 'reset_token_expires': None, 'verification_token': None, 'id': UUID('71d1ed3e-d7b6-49d2-873a-2b2d1ff0f772'), 'created_at': datetime.datetime(2025, 11, 11, 14, 5, 24, 475960), 'updated_at': datetime.datetime(2025, 11, 11, 14, 5, 24, 475965)}]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
üöÄ Starting EduAutismo IA API
üìç Environment: development
üîß Debug Mode: True
‚ö†Ô∏è  Database initialization warning: (psycopg2.OperationalError) could not translate host name "postgres" to address: Temporary failure in name resolution

(Background on this error at: https://sqlalche.me/e/20/e3q8)
_____________ ERROR at setup of TestAuthAPI.test_get_current_user ______________
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.UniqueViolation: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(test@example.com) already exists.

The above exception was the direct cause of the following exception:
tests/conftest.py:92: in test_user
    db_session.commit()
../venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:1969: in commit
    trans.commit(_to_root=True)
../venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py:139: in _go
    ret_value = fn(self, *arg, **kw)
../venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:1256: in commit
    self._prepare_impl()
../venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py:139: in _go
    ret_value = fn(self, *arg, **kw)
../venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:1231: in _prepare_impl
    self.session.flush()
../venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4312: in flush
    self._flush(objects)
../venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4447: in _flush
    with util.safe_reraise():
../venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:146: in __exit__
    raise exc_value.with_traceback(exc_tb)
../venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4408: in _flush
    flush_context.execute()
../venv/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
../venv/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
../venv/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
../venv/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py:1226: in _emit_insert_statements
    result = connection.execute(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1416: in execute
    return meth(
../venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:516: in _execute_on_connection
    return connection._execute_clauseelement(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1639: in _execute_clauseelement
    ret = self._execute_context(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1848: in _execute_context
    return self._exec_single_context(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1988: in _exec_single_context
    self._handle_dbapi_exception(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2343: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.IntegrityError: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(test@example.com) already exists.
E   
E   [SQL: INSERT INTO users (email, hashed_password, full_name, role, is_active, is_verified, phone, avatar_url, bio, institution, last_login, reset_token, reset_token_expires, verification_token, id, created_at, updated_at) VALUES (%(email)s, %(hashed_password)s, %(full_name)s, %(role)s, %(is_active)s, %(is_verified)s, %(phone)s, %(avatar_url)s, %(bio)s, %(institution)s, %(last_login)s, %(reset_token)s, %(reset_token_expires)s, %(verification_token)s, %(id)s::UUID, %(created_at)s, %(updated_at)s)]
E   [parameters: {'email': 'test@example.com', 'hashed_password': '$2b$12$gEM2ejjTxJ8wlXwWxjlRjOO/3f8XKTfccv2fVx2UMl6i6P/sVDvOe', 'full_name': 'Test User', 'role': 'TEACHER', 'is_active': True, 'is_verified': True, 'phone': None, 'avatar_url': None, 'bio': None, 'institution': None, 'last_login': None, 'reset_token': None, 'reset_token_expires': None, 'verification_token': None, 'id': UUID('71c8f3b3-1791-4088-847d-d7fccda6cd65'), 'created_at': datetime.datetime(2025, 11, 11, 14, 5, 35, 496267), 'updated_at': datetime.datetime(2025, 11, 11, 14, 5, 35, 496273)}]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
üöÄ Starting EduAutismo IA API
üìç Environment: development
üîß Debug Mode: True
‚ö†Ô∏è  Database initialization warning: (psycopg2.OperationalError) could not translate host name "postgres" to address: Temporary failure in name resolution

(Background on this error at: https://sqlalche.me/e/20/e3q8)
________ ERROR at setup of TestStudentsAPI.test_create_student_success _________
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.UniqueViolation: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(test@example.com) already exists.

The above exception was the direct cause of the following exception:
tests/conftest.py:92: in test_user
    db_session.commit()
../venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:1969: in commit
    trans.commit(_to_root=True)
../venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py:139: in _go
    ret_value = fn(self, *arg, **kw)
../venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:1256: in commit
    self._prepare_impl()
../venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py:139: in _go
    ret_value = fn(self, *arg, **kw)
../venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:1231: in _prepare_impl
    self.session.flush()
../venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4312: in flush
    self._flush(objects)
../venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4447: in _flush
    with util.safe_reraise():
../venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:146: in __exit__
    raise exc_value.with_traceback(exc_tb)
../venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4408: in _flush
    flush_context.execute()
../venv/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
../venv/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
../venv/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
../venv/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py:1226: in _emit_insert_statements
    result = connection.execute(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1416: in execute
    return meth(
../venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:516: in _execute_on_connection
    return connection._execute_clauseelement(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1639: in _execute_clauseelement
    ret = self._execute_context(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1848: in _execute_context
    return self._exec_single_context(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1988: in _exec_single_context
    self._handle_dbapi_exception(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2343: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.IntegrityError: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(test@example.com) already exists.
E   
E   [SQL: INSERT INTO users (email, hashed_password, full_name, role, is_active, is_verified, phone, avatar_url, bio, institution, last_login, reset_token, reset_token_expires, verification_token, id, created_at, updated_at) VALUES (%(email)s, %(hashed_password)s, %(full_name)s, %(role)s, %(is_active)s, %(is_verified)s, %(phone)s, %(avatar_url)s, %(bio)s, %(institution)s, %(last_login)s, %(reset_token)s, %(reset_token_expires)s, %(verification_token)s, %(id)s::UUID, %(created_at)s, %(updated_at)s)]
E   [parameters: {'email': 'test@example.com', 'hashed_password': '$2b$12$a4EazBHfU8oqKkNjKv1cjetDFa8EVEwALrHrsOv65eEZhvL4ppYOq', 'full_name': 'Test User', 'role': 'TEACHER', 'is_active': True, 'is_verified': True, 'phone': None, 'avatar_url': None, 'bio': None, 'institution': None, 'last_login': None, 'reset_token': None, 'reset_token_expires': None, 'verification_token': None, 'id': UUID('bc3fe171-216d-4453-8940-c6ad621b6d84'), 'created_at': datetime.datetime(2025, 11, 11, 14, 5, 54, 215872), 'updated_at': datetime.datetime(2025, 11, 11, 14, 5, 54, 215880)}]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
üöÄ Starting EduAutismo IA API
üìç Environment: development
üîß Debug Mode: True
‚ö†Ô∏è  Database initialization warning: (psycopg2.OperationalError) could not translate host name "postgres" to address: Temporary failure in name resolution

(Background on this error at: https://sqlalche.me/e/20/e3q8)
______ ERROR at setup of TestStudentsAPI.test_create_student_invalid_date ______
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.UniqueViolation: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(test@example.com) already exists.

The above exception was the direct cause of the following exception:
tests/conftest.py:92: in test_user
    db_session.commit()
../venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:1969: in commit
    trans.commit(_to_root=True)
../venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py:139: in _go
    ret_value = fn(self, *arg, **kw)
../venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:1256: in commit
    self._prepare_impl()
../venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py:139: in _go
    ret_value = fn(self, *arg, **kw)
../venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:1231: in _prepare_impl
    self.session.flush()
../venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4312: in flush
    self._flush(objects)
../venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4447: in _flush
    with util.safe_reraise():
../venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:146: in __exit__
    raise exc_value.with_traceback(exc_tb)
../venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4408: in _flush
    flush_context.execute()
../venv/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
../venv/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
../venv/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
../venv/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py:1226: in _emit_insert_statements
    result = connection.execute(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1416: in execute
    return meth(
../venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:516: in _execute_on_connection
    return connection._execute_clauseelement(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1639: in _execute_clauseelement
    ret = self._execute_context(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1848: in _execute_context
    return self._exec_single_context(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1988: in _exec_single_context
    self._handle_dbapi_exception(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2343: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.IntegrityError: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(test@example.com) already exists.
E   
E   [SQL: INSERT INTO users (email, hashed_password, full_name, role, is_active, is_verified, phone, avatar_url, bio, institution, last_login, reset_token, reset_token_expires, verification_token, id, created_at, updated_at) VALUES (%(email)s, %(hashed_password)s, %(full_name)s, %(role)s, %(is_active)s, %(is_verified)s, %(phone)s, %(avatar_url)s, %(bio)s, %(institution)s, %(last_login)s, %(reset_token)s, %(reset_token_expires)s, %(verification_token)s, %(id)s::UUID, %(created_at)s, %(updated_at)s)]
E   [parameters: {'email': 'test@example.com', 'hashed_password': '$2b$12$l9DOpXN6Bta12aDN8nxfruOtkgF2gly7pui571eyZpaM.Vj/5HdVq', 'full_name': 'Test User', 'role': 'TEACHER', 'is_active': True, 'is_verified': True, 'phone': None, 'avatar_url': None, 'bio': None, 'institution': None, 'last_login': None, 'reset_token': None, 'reset_token_expires': None, 'verification_token': None, 'id': UUID('4b408f7e-e351-4abe-aeba-722733a858f9'), 'created_at': datetime.datetime(2025, 11, 11, 14, 6, 15, 216745), 'updated_at': datetime.datetime(2025, 11, 11, 14, 6, 15, 216751)}]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
üöÄ Starting EduAutismo IA API
üìç Environment: development
üîß Debug Mode: True
‚ö†Ô∏è  Database initialization warning: (psycopg2.OperationalError) could not translate host name "postgres" to address: Temporary failure in name resolution

(Background on this error at: https://sqlalche.me/e/20/e3q8)
_______ ERROR at setup of TestStudentsAPI.test_create_student_too_young ________
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   psycopg2.errors.UniqueViolation: duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(test@example.com) already exists.

The above exception was the direct cause of the following exception:
tests/conftest.py:92: in test_user
    db_session.commit()
../venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:1969: in commit
    trans.commit(_to_root=True)
../venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py:139: in _go
    ret_value = fn(self, *arg, **kw)
../venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:1256: in commit
    self._prepare_impl()
../venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py:139: in _go
    ret_value = fn(self, *arg, **kw)
../venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:1231: in _prepare_impl
    self.session.flush()
../venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4312: in flush
    self._flush(objects)
../venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4447: in _flush
    with util.safe_reraise():
../venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py:146: in __exit__
    raise exc_value.with_traceback(exc_tb)
../venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py:4408: in _flush
    flush_context.execute()
../venv/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py:466: in execute
    rec.execute(self)
../venv/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
../venv/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py:93: in save_obj
    _emit_insert_statements(
../venv/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py:1226: in _emit_insert_statements
    result = connection.execute(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1416: in execute
    return meth(
../venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:516: in _execute_on_connection
    return connection._execute_clauseelement(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1639: in _execute_clauseelement
    ret = self._execute_context(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1848: in _execute_context
    return self._exec_single_context(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1988: in _exec_single_context
    self._handle_dbapi_exception(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2343: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
../venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1969: in _exec_single_context
    self.dialect.do_execute(
../venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py:922: in do_execute
    cursor.execute(statement, parameters)
E   sqlalchemy.exc.IntegrityError: (psycopg2.errors.UniqueViolation) duplicate key value violates unique constraint "ix_users_email"
E   DETAIL:  Key (email)=(test@example.com) already exists.
E   
E   [SQL: INSERT INTO users (email, hashed_password, full_name, role, is_active, is_verified, phone, avatar_url, bio, institution, last_login, reset_token, reset_token_expires, verification_token, id, created_at, updated_at) VALUES (%(email)s, %(hashed_password)s, %(full_name)s, %(role)s, %(is_active)s, %(is_verified)s, %(phone)s, %(avatar_url)s, %(bio)s, %(institution)s, %(last_login)s, %(reset_token)s, %(reset_token_expires)s, %(verification_token)s, %(id)s::UUID, %(created_at)s, %(updated_at)s)]
E   [parameters: {'email': 'test@example.com', 'hashed_password': '$2b$12$mwmftRO5CZCCl3KSh3Ttw.XSDi9LrpAUmEOfJ5KGY9EYxX.tZHph.', 'full_name': 'Test User', 'role': 'TEACHER', 'is_active': True, 'is_verified': True, 'phone': None, 'avatar_url': None, 'bio': None, 'institution': None, 'last_login': None, 'reset_token': None, 'reset_token_expires': None, 'verification_token': None, 'id': UUID('dbe55406-ec31-4993-b6c3-6232cd9e52dc'), 'created_at': datetime.datetime(2025, 11, 11, 14, 6, 23, 916844), 'updated_at': datetime.datetime(2025, 11, 11, 14, 6, 23, 916850)}]
E   (Background on this error at: https://sqlalche.me/e/20/gkpj)
---------------------------- Captured stdout setup -----------------------------
üöÄ Starting EduAutismo IA API
üìç Environment: development
üîß Debug Mode: True
‚ö†Ô∏è  Database initialization warning: (psycopg2.OperationalError) could not translate host name "postgres" to address: Temporary failure in name resolution

(Background on this error at: https://sqlalche.me/e/20/e3q8)
=================================== FAILURES ===================================
_____________________ TestAuthAPI.test_unauthorized_access _____________________
tests/integration/test_auth_api.py:92: in test_unauthorized_access
    assert response.status_code == 403
E   assert 401 == 403
E    +  where 401 = <Response [401 Unauthorized]>.status_code
---------------------------- Captured stdout setup -----------------------------
üöÄ Starting EduAutismo IA API
üìç Environment: development
üîß Debug Mode: True
‚ö†Ô∏è  Database initialization warning: (psycopg2.OperationalError) could not translate host name "postgres" to address: Temporary failure in name resolution

(Background on this error at: https://sqlalche.me/e/20/e3q8)
----------------------------- Captured stdout call -----------------------------
üì• GET /api/v1/auth/me
üì§ Status: 401
[32m[INFO][0m - 2025-11-11 11:05:46 - httpx - HTTP Request: GET http://testserver/api/v1/auth/me "HTTP/1.1 401 Unauthorized"
------------------------------ Captured log call -------------------------------
INFO     httpx:_client.py:1013 HTTP Request: GET http://testserver/api/v1/auth/me "HTTP/1.1 401 Unauthorized"
--------------------------- Captured stdout teardown ---------------------------
üõë Shutting down EduAutismo IA API
=============================== warnings summary ===============================
../venv/lib/python3.12/site-packages/pydantic/_internal/_config.py:268
../venv/lib/python3.12/site-packages/pydantic/_internal/_config.py:268
  /mnt/d/ENGINEER/VS_Code/eduautismo-ia-mvp/venv/lib/python3.12/site-packages/pydantic/_internal/_config.py:268: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.5/migration/
    warnings.warn(DEPRECATION_MESSAGE, DeprecationWarning)

app/core/database.py:20
  /mnt/d/ENGINEER/VS_Code/eduautismo-ia-mvp/backend/app/core/database.py:20: MovedIn20Warning: The ``declarative_base()`` function is now available as sqlalchemy.orm.declarative_base(). (deprecated since: 2.0) (Background on SQLAlchemy 2.0 at: https://sqlalche.me/e/b8d9)
    Base = declarative_base()

app/db/base.py:18
  /mnt/d/ENGINEER/VS_Code/eduautismo-ia-mvp/backend/app/db/base.py:18: MovedIn20Warning: The ``declarative_base()`` function is now available as sqlalchemy.orm.declarative_base(). (deprecated since: 2.0) (Background on SQLAlchemy 2.0 at: https://sqlalche.me/e/b8d9)
    Base = declarative_base()

../venv/lib/python3.12/site-packages/passlib/utils/__init__.py:854
  /mnt/d/ENGINEER/VS_Code/eduautismo-ia-mvp/venv/lib/python3.12/site-packages/passlib/utils/__init__.py:854: DeprecationWarning: 'crypt' is deprecated and slated for removal in Python 3.13
    from crypt import crypt as _crypt

tests/integration/test_activities_api.py: 14 warnings
tests/integration/test_auth_api.py: 9 warnings
tests/integration/test_students_api.py: 6 warnings
  /mnt/d/ENGINEER/VS_Code/eduautismo-ia-mvp/venv/lib/python3.12/site-packages/sqlalchemy/sql/schema.py:3592: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

tests/integration/test_activities_api.py::TestActivitiesAPI::test_generate_activity_success
  /mnt/d/ENGINEER/VS_Code/eduautismo-ia-mvp/backend/app/core/security.py:55: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    expire = datetime.utcnow() + expires_delta

tests/integration/test_activities_api.py::TestActivitiesAPI::test_generate_activity_success
  /mnt/d/ENGINEER/VS_Code/eduautismo-ia-mvp/backend/app/core/security.py:81: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    expire = datetime.utcnow() + timedelta(days=settings.REFRESH_TOKEN_EXPIRE_DAYS)

tests/integration/test_activities_api.py::TestActivitiesAPI::test_generate_activity_success
  /mnt/d/ENGINEER/VS_Code/eduautismo-ia-mvp/backend/app/api/routes/auth.py:124: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    user.last_login_at = datetime.utcnow()

tests/integration/test_activities_api.py::TestActivitiesAPI::test_generate_activity_success
  /mnt/d/ENGINEER/VS_Code/eduautismo-ia-mvp/venv/lib/python3.12/site-packages/jose/jwt.py:311: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    now = timegm(datetime.utcnow().utctimetuple())

tests/integration/test_auth_api.py::TestAuthAPI::test_register_user_success
  /mnt/d/ENGINEER/VS_Code/eduautismo-ia-mvp/backend/app/api/routes/auth.py:179: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    created_at=datetime.utcnow()

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
FAILED tests/integration/test_auth_api.py::TestAuthAPI::test_unauthorized_access
ERROR tests/integration/test_activities_api.py::TestActivitiesAPI::test_generate_activity_without_auth
ERROR tests/integration/test_activities_api.py::TestActivitiesAPI::test_generate_activity_nonexistent_student
ERROR tests/integration/test_activities_api.py::TestActivitiesAPI::test_generate_activity_invalid_duration
ERROR tests/integration/test_activities_api.py::TestActivitiesAPI::test_generate_multiple_activity_types
ERROR tests/integration/test_auth_api.py::TestAuthAPI::test_register_duplicate_email
ERROR tests/integration/test_auth_api.py::TestAuthAPI::test_login_success - s...
ERROR tests/integration/test_auth_api.py::TestAuthAPI::test_login_invalid_credentials
ERROR tests/integration/test_auth_api.py::TestAuthAPI::test_get_current_user
ERROR tests/integration/test_students_api.py::TestStudentsAPI::test_create_student_success
ERROR tests/integration/test_students_api.py::TestStudentsAPI::test_create_student_invalid_date
ERROR tests/integration/test_students_api.py::TestStudentsAPI::test_create_student_too_young
======= 1 failed, 3 passed, 39 warnings, 11 errors in 153.36s (0:02:33) ========
