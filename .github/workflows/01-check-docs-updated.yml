name: 01 - Check Docs Updated

on:
  workflow_call:
    # This workflow can be called by other workflows

jobs:
  check-docs:
    name: Verify Documentation is Updated
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: Verify documentation consistency
        id: verify
        run: |
          echo "ðŸ” Verificando consistÃªncia da documentaÃ§Ã£o..."
          python scripts/update_docs.py --check-only
          exit_code=$?

          if [ $exit_code -ne 0 ]; then
            echo "status=outdated" >> $GITHUB_OUTPUT
            echo "âŒ DocumentaÃ§Ã£o precisa ser atualizada"
            exit 1
          else
            echo "status=ok" >> $GITHUB_OUTPUT
            echo "âœ… DocumentaÃ§Ã£o estÃ¡ atualizada"
            exit 0
          fi

      - name: Comment on PR if docs are outdated
        if: failure() && steps.verify.outputs.status == 'outdated'
        uses: actions/github-script@v7
        with:
          script: |
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: `## âš ï¸ DocumentaÃ§Ã£o Desatualizada

            A documentaÃ§Ã£o precisa ser atualizada para refletir as mudanÃ§as no cÃ³digo.

            ### Como corrigir:

            1. Execute localmente:
               \`\`\`bash
               python scripts/update_docs.py
               \`\`\`

            2. Ou aguarde a atualizaÃ§Ã£o automÃ¡tica apÃ³s o merge para \`main\`

            ### O que verificamos:
            - âœ… Paths e imports corretos (app/ vs src/)
            - âœ… Comandos atualizados
            - âœ… URLs corretas do repositÃ³rio
            - âœ… VersÃµes e datas atualizadas

            ðŸ¤– VerificaÃ§Ã£o automÃ¡tica executada por GitHub Actions`
            })

      - name: Create summary
        if: always()
        run: |
          echo "## ðŸ“š VerificaÃ§Ã£o de DocumentaÃ§Ã£o" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY

          if [ "${{ steps.verify.outputs.status }}" == "ok" ]; then
            echo "âœ… DocumentaÃ§Ã£o estÃ¡ consistente com o cÃ³digo" >> $GITHUB_STEP_SUMMARY
          else
            echo "âŒ DocumentaÃ§Ã£o precisa ser atualizada" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "Execute: \`python scripts/update_docs.py\`" >> $GITHUB_STEP_SUMMARY
          fi
